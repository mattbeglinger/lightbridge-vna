apiVersion: v1
kind: ConfigMap
metadata:
  name: ohif-config
data:
  app-config.js: |
    window.config = {
      // 1. App Routing (Must match Ingress path)
      routerBasename: '/viewer',
      extensions: [],
      modes: [],
      showStudyList: true,
      
      // 2. OIDC Configuration (Single Sign-On with Keycloak)
      oidc: [
        {
          // We use relative paths so this works on ANY domain (AWS or Azure)
          authority: window.location.origin + '/auth/realms/lightbridge',
          client_id: 'ohif-viewer',
          redirect_uri: window.location.origin + '/viewer/callback',
          response_type: 'code',
          scope: 'openid profile email',
          post_logout_redirect_uri: window.location.origin + '/viewer',
        },
      ],

      // 3. Data Source Configuration (Orthanc via DICOMWeb)
      dataSources: [
        {
          friendlyName: 'Lightbridge VNA',
          namespace: '@ohif/extension-default.dataSourcesModule.dicomweb',
          sourceName: 'dicomweb',
          configuration: {
            name: 'Orthanc',
            // Point to the Ingress route we created for Orthanc
            wadoUriRoot: '/dicom-web',
            qidoRoot: '/dicom-web',
            wadoRoot: '/dicom-web',
            
            // Standard DICOMWeb settings
            qidoSupportsIncludeField: false,
            imageRendering: 'wadors',
            thumbnailRendering: 'wadors',
            enableStudyLazyLoad: true,
            supportsFuzzyMatching: true,
            supportsWildcard: true,
          },
        },
      ],
      defaultDataSourceName: 'dicomweb',
    };